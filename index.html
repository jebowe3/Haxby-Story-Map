<!DOCTYPE html>
<html lang="en">
<head>
	<title>Haxby Project</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--stylesheets-->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<link rel="stylesheet" type="text/css" href="css/storymap.css">
	<link rel="stylesheet" href="css/main.css" />
	<link rel="stylesheet" href="css/L.Control.Layers.Tree.css" crossorigin=""/>

	<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Courgette|Inconsolata|Titillium+Web|Fira+Sans+Condensed" />
	<!--Bootstrap-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<!--leaflet-->
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="js/leaflet-d3.js"></script>
	<!--side by side comparison-->
	<script src="js/leaflet-side-by-side.js"></script>

	<!-- mini globle map -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
	<script src="js/globeminimap.js"></script>
	<script src="js/storymap.js"></script>

	<script src="js/jqcloud.js"></script>
	<script src="js/L.Control.Layers.Tree.js"></script>

	<script src="js/attrchange.js"></script>
  <script src="js/attrchange_ext.js"></script>
</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top navbar-toggleable-md" role="navigation">
	<div class="container-fluid" >
		<a class="navbar-brand" href="#">
			<img src="img/favicon.ico" class="align-top" height="20px" align="left"> &nbsp;
		</a>
		<div class="navbar-header">
			<a class="navbar-brand" href="#">Haxby Project</a>
		</div>

		<div class="collapse navbar-collapse">
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a href="javascript:window.scrollBy(0,$('section[data-scene=homepage]').offset().top-$(window).scrollTop()-40);">Home Page</a>
				</li>
				<li>
					<a href="javascript:window.scrollBy(0,$('section[data-scene=scene1]').offset().top-$(window).scrollTop()-40);">Mapping the Seafloor Through History</a>
				</li>
<!--
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Historical Seafloor Mapping<span class="caret"></span></a>
					<ul class="dropdown-menu">
						<li>
							<a href="javascript:window.scrollBy(0,$('section[data-scene=scene1]').offset().top-$(window).scrollTop()-40);">Scene 1</a>
						</li>
						<li>
							<a href="javascript:window.scrollBy(0,$('section[data-scene=scene2]').offset().top-$(window).scrollTop()-40);">Scene 2</a>
						</li>
						<li>
							<a href="javascript:window.scrollBy(0,$('section[data-scene=scene3]').offset().top-$(window).scrollTop()-40);">Scene 3</a>
						</li>
-->
<!--
						<li>
							<a href="javascript:window.scrollBy(0,$('section[data-scene=map_hex_case1]').offset().top-$(window).scrollTop()-40);">Content 2</a>
						</li>
-->
					</ul>
				</li>
			</ul>
		</div>
	</div>
</div>

<div class="container-fluid">
	<div class="row">
		<div id="scenes" class="col-sm-6 col-md-4 main">

			<section class="homepage" data-scene="homepage">
        <h2>Haxby Project Title</h2>
				<h3>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</h3>
      </section>

			<section class="scene1" data-scene="scene1">
        <h2>Mapping the Seafloor Through History</h2>
				<h3>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</h3><br>
				<h3>Click the radio control in the top right corner to compare important maps in the historical progression of Atlantic seafloor mapping.</h3>
      </section>
<!--
			<section class="scene2" data-scene="scene2">
				<h2>Scene 2</h2>
				<h3>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</h3>
			</section>

			<section class="scene3" data-scene="scene3">
				<h2>Scene 3</h2>
				<h3>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</h3>
			</section>

			<section class="scene4" data-scene="map_hex_case1">
				<h2>Scene 4</h2>
      </section>
-->
		</div>
		<div id="map" class="col-sm-6 col-md-8 sidebar"></div>
	</div>
	<i class="animated zoomIn infinite glyphicon glyphicon-menu-down arrow-down arrow-down-custom2"></i>
	<div class="progress-line"></div>
	<ul class="navwidget text-center"></ul>

</div>

<script type="text/javascript">

		const esriTerrain = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}', {
			attribution: 'Tiles &copy; Esri &mdash; Source: USGS, Esri, TANA, DeLorme, and NPS',
			maxZoom: 13
		});
		const mauryLayer1 = L.tileLayer('maury-1854-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 1, maxZoom: 5});
		const mauryLayer2 = L.tileLayer('maury-1854-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 1, maxZoom: 5});
		const mauryLayer3 = L.tileLayer('maury-1854-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 1, maxZoom: 5});
		const mauryLayer4 = L.tileLayer('maury-1854-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 1, maxZoom: 5});
		const andreeLayer1 = L.tileLayer('andree-1900-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 5});
		const andreeLayer2 = L.tileLayer('andree-1900-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 5});
		const andreeLayer3 = L.tileLayer('andree-1900-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 5});
		const andreeLayer4 = L.tileLayer('andree-1900-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 5});
		const tharpLayer1 = L.tileLayer('heezen-tharp-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 7});
		const tharpLayer2 = L.tileLayer('heezen-tharp-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 7});
		const tharpLayer3 = L.tileLayer('heezen-tharp-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 7});
		const tharpLayer4 = L.tileLayer('heezen-tharp-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 7});
		const haxbyLayer1 = L.tileLayer('haxby-1983-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 4});
		const haxbyLayer2 = L.tileLayer('haxby-1983-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 4});
		const haxbyLayer3 = L.tileLayer('haxby-1983-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 4});
		const haxbyLayer4 = L.tileLayer('haxby-1983-tiles/{z}/{x}/{y}.png', {tms: true, opacity: 1.0, attribution: "", minZoom: 0, maxZoom: 4});
    const gmrtLayer1 = L.tileLayer.wms('https://www.gmrt.org/services/mapserver/wms_merc?', {layers: 'topo'});
		const gmrtLayer2 = L.tileLayer.wms('https://www.gmrt.org/services/mapserver/wms_merc?', {layers: 'topo'});
		const gmrtLayer3 = L.tileLayer.wms('https://www.gmrt.org/services/mapserver/wms_merc?', {layers: 'topo'});
		const gmrtLayer4 = L.tileLayer.wms('https://www.gmrt.org/services/mapserver/wms_merc?', {layers: 'topo'});

		const mLayer1 = L.layerGroup([mauryLayer1, andreeLayer1]);
		const mLayer2 = L.layerGroup([mauryLayer2, tharpLayer1]);
		const mLayer3 = L.layerGroup([mauryLayer3, haxbyLayer1]);
		const mLayer4 = L.layerGroup([mauryLayer4, gmrtLayer1]);

		const aLayer1 = L.layerGroup([andreeLayer2, tharpLayer2]);
		const aLayer2 = L.layerGroup([andreeLayer3, haxbyLayer2]);
		const aLayer3 = L.layerGroup([andreeLayer4, gmrtLayer2]);

		const tLayer1 = L.layerGroup([tharpLayer3, haxbyLayer3]);
		const tLayer2 = L.layerGroup([tharpLayer4, gmrtLayer3]);

		const hLayer1 = L.layerGroup([haxbyLayer4, gmrtLayer4]);

/*
		const baseMaps = {
      "Heezen-Tharp, 1977": tharpLayer,
      "Contemporary GMRT": gmrtLayer
    };
*/
    const layers = {
			'esriTerrain' : [esriTerrain],
			'mLayer1' : [mLayer1],
			'mLayer2' : [mLayer2],
			'mLayer3' : [mLayer3],
			'mLayer4' : [mLayer4],
			'aLayer1' : [aLayer1],
			'aLayer2' : [aLayer2],
			'aLayer3' : [aLayer3],
			'tLayer1' : [tLayer1],
			'tLayer2' : [tLayer2],
			'hLayer1' : [hLayer1]
    };

		const baseTree = {
			label: '<h6>Historic Seafloor Maps</h6>',
			children: [
					{
							label: '<h6>1854 - Matthew Fontaine Maury</h6>',
							collapsed: true,
							children: [
									{ label: '<h6>Maury, 1854 vs. Andree, 1900</h6>', layer: mLayer1 },
									{ label: '<h6>Maury, 1854 vs. Heezen-Tharp, 1977</h6>', layer: mLayer2 },
									{ label: '<h6>Maury, 1854 vs. Haxby, 1983</h6>', layer: mLayer3 },
									{ label: '<h6>Maury, 1854 vs. Contemporary GMRT</h6>', layer: mLayer4 },
							]
					},
					{
							label: '<h6>1900 - Richard Andree</h6>',
							collapsed: true,
							children: [
									{ label: '<h6>Andree, 1900 vs. Heezen-Tharp, 1977</h6>', layer: aLayer1 },
									{ label: '<h6>Andree, 1900 vs. Haxby, 1983</h6>', layer: aLayer2 },
									{ label: '<h6>Andree, 1900 vs. Contemporary GMRT</h6>', layer: aLayer3 },
							]
					},
					{
							label: '<h6>1977 - Heezen-Tharp</h6>',
							collapsed: true,
							children: [
									{ label: '<h6>Heezen-Tharp, 1977 vs. Haxby, 1983</h6>', layer: tLayer1 },
									{ label: '<h6>Heezen-Tharp, 1977 vs. Contemporary GMRT</h6>', layer: tLayer2 },
							]
					},
					{
							label: '<h6>1983 - Haxby</h6>',
							collapsed: true,
							children: [
									{ label: '<h6>Haxby, 1983 vs. Contemporary GMRT</h6>', layer: hLayer1 },
							]
					}
			]
		};

    const scenes = {
			homepage: {lat: 28.5, lng: -36, zoom: 4, layers: ['esriTerrain'], name: "homepage"},
			scene1: {lat: 28.5, lng: -36, zoom: 4, layers: ['mLayer1', 'mLayer2', 'mLayer3', 'mLayer4', 'aLayer1', 'aLayer2', 'aLayer3', 'tLayer1', 'tLayer2', 'hLayer1'], name: "scene 1"},
			//scene1: {lat: 28.5, lng: -36, zoom: 4, layers: ['mauryLayer', 'andreeLayer'], name: "scene 1"},
      //scene2: {lat: 28.5, lng:-36, zoom: 4, layers: ['andreeLayer', 'tharpLayer'], name: "scene 2"},
			//scene3: {lat: 28.5, lng:-36, zoom: 4, layers: ['tharpLayer', 'gmrtLayer'], name: "scene 3"}
    };

    $('.main').storymap({
        scenes: scenes,
        layers:layers,
        legend: false,
        scale:false,
        navwidget: true,
        createMap: function () {
            // create a map in the "map" div, set the view to a given place and zoom
            const map = L.map('map', {zoomControl: false, dragging: true, scrollWheelZoom: true, maxZoom: 14}).setView([44.1347254, -122.7411479], 7);
            map.doubleClickZoom.disable();

						const controlCase1 = L.control.layers.tree(baseTree, null, {
							position: 'topright',
							collapsed: false,
							//namedToggle: true,
							//groupsCollapsable: true,
  						//groupsExpandedClass: "glyphicon glyphicon-chevron-down",
  						//groupsCollapsedClass: "glyphicon glyphicon-chevron-right",
							//exclusiveGroups: ["<h6>1854 - Matthew Fontaine Maury</h6>","<h6>1900 - Richard Andree</h6>"]
						});

						controlCase1.collapseTree(baseTree);

						const layerControl1 = L.control.sideBySide([mauryLayer2, mauryLayer3, mauryLayer4, andreeLayer1, andreeLayer2, andreeLayer3, mauryLayer1, tharpLayer3, tharpLayer4, haxbyLayer4],[tharpLayer1, haxbyLayer1, gmrtLayer1, tharpLayer2, haxbyLayer2, gmrtLayer2, andreeLayer1, haxbyLayer3, gmrtLayer3, gmrtLayer4]);

						// Add a function to check when scenes become visible (when they add a 'viewing' class)
						$(function () {

							$('.homepage').attrchange({
								trackValues: true,
								callback: function (event) {
									//var properties = $(this).attrchange('getProperties');
									// when the homepage becomes visible...
									if ($(".homepage").hasClass("viewing")) {
										map.removeLayer(mLayer1);
										map.removeLayer(mLayer2);
										map.removeLayer(mLayer3);
										map.removeLayer(mLayer4);
										map.removeLayer(aLayer1);
										map.removeLayer(aLayer2);
										map.removeLayer(aLayer3);
										map.removeLayer(tLayer1);
										map.removeLayer(tLayer2);
										map.removeLayer(hLayer1);
										map.removeControl(controlCase1);
										map.removeControl(layerControl1);
										esriTerrain.bringToFront();
										// when scene1 becomes visible...
									} else if ($(".scene1").hasClass("viewing")) {
										map.addLayer(mLayer1);
										map.removeLayer(mLayer2);
										map.removeLayer(mLayer3);
										map.removeLayer(mLayer4);
										map.removeLayer(aLayer1);
										map.removeLayer(aLayer2);
										map.removeLayer(aLayer3);
										map.removeLayer(tLayer1);
										map.removeLayer(tLayer2);
										map.removeLayer(hLayer1);
										map.addControl(controlCase1);
										map.addControl(layerControl1);
									} else {
										console.log("scenes not visible");
									}
								}
							});

						});

            miniMap = new L.Control.GlobeMiniMap({
                marker:'#B51E1E',
                position: 'bottomright'
            }).addTo(map);

            document.getElementsByClassName("leaflet-control-attribution")[0].style.visibility = "hidden";
            return map;

        }
    });
/*
		// Need to edit this function to check if the element is visible inside its parent,
		// or some other way of checking to see if only the desired element is 100% in view
		function elementInViewport(el) {

			var top = el.offsetTop;
			var left = el.offsetLeft;
			var width = el.offsetWidth;
			var height = el.offsetHeight;

			while(el.offsetParent) {
				el = el.offsetParent;
				top += el.offsetTop;
				left += el.offsetLeft;
			}

			return (
				top >= window.pageYOffset &&
				left >= window.pageXOffset &&
				(top + height) <= (window.pageYOffset + window.innerHeight) &&
				(left + width) <= (window.pageXOffset + window.innerWidth)
			);

		}
*/
</script>
</body>
</html>
